---
layout:     post
title:      Web 项目安全机制和权限管理
subtitle:   Web 项目中用户安全策略和权限管理的实现过程
date:       2017-10-25
author:     uncledrew
header-img: img/post-bg-re-vs-ng2.jpg
catalog: true
tags:
    - Web
    - Token
    - 加密
    - 权限
    - 安全
---

> 纸上得来终觉浅，绝知此事要躬行。
>
> [我的博客](http://uncledrewzhu.github.io/)

# 总览图

![](http://oxy6ml8al.bkt.clouddn.com/secrity-flow.png)
当一个外部请求发给服务器端，首先经过过滤器进行行为采集，然后经过拦截器进行身份验证，最后经过控制层、服务层、数据层根据用户的权限获取对应的数据。

# 过滤器行为采集
![](http://oxy6ml8al.bkt.clouddn.com/secrity-filter.png)
将请求路径，请求参数，请求体，头部信息，ip地址，端口，用户部门等信息记录到日志系统中，可以对用户进行行为分析。

# 拦截器身份验证
![](http://oxy6ml8al.bkt.clouddn.com/secrity-interceptor.png)
1. 验证用户请求头部信息是否合法，如果不合法，则抛出异常。
2. 验证用户登录时获取到的请求令牌(token)是否合法，如果不合法，则抛出异常。
3. 验证用户发起请求时的主机地址，防止 token 被窃取。如果请求的主机地址与登录时获取 token 时的主机地址不匹配，则抛出异常。
4. 验证用户状态，防止用户登录后被删除或者被冻结后还能访问服务器。如果此时用户状态不合法，则抛出异常。

# 数据加密方式
![](http://oxy6ml8al.bkt.clouddn.com/secrity-encrypt.png)
加密方式是如何进化的：
- 可逆加密：点点鼠标，轻轻松松就可破解
- 简单的不可逆加密：彩虹库 + 超强的 GPU 运算能力 = 暴力破解
- hash 加密：
    - 一次 MD5
    - 将密码与一个随机字符串进行一次 MD5
    - 两次 MD5，使用一个随机字符串与密码的 MD5 值再进行一次 MD5
    - HS256： 用于 [JWT(JSON Web Token)](https://en.wikipedia.org/wiki/JSON_Web_Token)，使用 HMAC-SHA256 签名，进行加密
    - [PBKDF2](https://en.wikipedia.org/wiki/PBKDF2)：使用 SHA(SHA1、SHA256) 签名配合 salt 值，再配合 10000 次运算，进行加密

# 用户权限管理
![](http://oxy6ml8al.bkt.clouddn.com/secrity-privilege.png)



